# 아그리인덱스(AgriIndex) 상세 설계서

## 📋 기본 정보
- **부문**: 아이디어 기획 (팜맵 외 데이터 활용)
- **서비스명**: 아그리인덱스(AgriIndex)
- **핵심 가치**: 7개 공공데이터 융합을 통한 농업 종합 지수 산출

---

## 🧮 핵심 알고리즘 설계

### 📊 농업 종합 지수(ACI: Agricultural Composite Index) 계산 공식

#### 1단계: 개별 지수 계산 (각 0-100점)

```python
# 1. 기상 위험 지수 (Weather Risk Index)
WRI = 100 - (강수량편차*0.3 + 온도편차*0.3 + 극한기상일수*0.4)

# 2. 토양 건강 지수 (Soil Health Index)  
SHI = (pH적정도*0.3 + 유기물함량*0.4 + 영양상태*0.3)

# 3. 병해충 위험 지수 (Pest Risk Index)
PRI = 100 - (발생확률*0.6 + 피해심각도*0.4)

# 4. 시장 가치 지수 (Market Value Index)
MVI = (현재가격/평년가격*50) + (가격안정성*50)

# 5. 정책 지원 지수 (Policy Support Index)
PSI = (지원사업개수*30) + (지원금규모*40) + (선정확률*30)

# 6. 지리적 적합성 지수 (Geographic Suitability Index)
GSI = (농경지품질*0.4 + 접근성*0.3 + 인프라*0.3)
```

#### 2단계: 종합 지수 계산 (가중평균)

```python
# 농업 종합 지수 (0-100점)
ACI = (WRI*0.25 + SHI*0.20 + PRI*0.20 + MVI*0.15 + PSI*0.10 + GSI*0.10)

# 위험도 등급 분류
if ACI >= 80: 등급 = "매우좋음(A)"
elif ACI >= 70: 등급 = "좋음(B)" 
elif ACI >= 60: 등급 = "보통(C)"
elif ACI >= 50: 등급 = "주의(D)"
else: 등급 = "위험(E)"
```

### 🤖 AI 예측 모델 (30일 후 예측)

```python
# 시계열 예측 모델 (LSTM + Transformer)
import tensorflow as tf

def predict_future_aci(historical_data, weather_forecast):
    # 입력: 과거 90일 ACI + 향후 30일 기상예보
    # 출력: 향후 30일 예상 ACI
    
    model = tf.keras.Sequential([
        tf.keras.layers.LSTM(64, return_sequences=True),
        tf.keras.layers.Dropout(0.2),
        tf.keras.layers.LSTM(32),
        tf.keras.layers.Dense(30)  # 30일 예측
    ])
    
    return predicted_aci
```

---

## 🎨 UI/UX 설계

### 📱 메인 대시보드 (웹/모바일)

#### 상단 헤더
```
[로고] 아그리인덱스  [내 농장] [지역비교] [예측] [알림] [설정]
```

#### 핵심 영역 (가로 레이아웃)
```
┌─────────────────┬─────────────────┬─────────────────┐
│   농업종합지수   │    위험 알림     │   예측 그래프   │
│      85점       │   병해충 주의    │   30일 추이     │
│   매우좋음(A)    │   (3일 후)      │   ↗ 상승 예상   │
└─────────────────┴─────────────────┴─────────────────┘
```

#### 세부 지수 (6개 카드 레이아웃)
```
┌─────────┬─────────┬─────────┐
│ 기상위험 │ 토양건강 │ 병해충   │
│   92점  │   78점  │   85점  │
│   🌤️   │   🌱   │   🐛   │
└─────────┴─────────┴─────────┘
┌─────────┬─────────┬─────────┐
│ 시장가치 │ 정책지원 │ 지리적합 │
│   88점  │   65점  │   90점  │
│   💰    │   📋   │   📍   │
└─────────┴─────────┴─────────┘
```

### 🗺️ 지도 기반 인터페이스

#### 팜맵 연동 시각화
```python
# Folium 기반 인터랙티브 지도
import folium

def create_aci_map():
    m = folium.Map(location=[36.5, 127.5], zoom_start=7)
    
    # 지역별 ACI 점수에 따른 색상 매핑
    color_map = {
        'A': '#00FF00',  # 녹색 (매우좋음)
        'B': '#90EE90',  # 연녹색 (좋음)  
        'C': '#FFFF00',  # 노란색 (보통)
        'D': '#FFA500',  # 주황색 (주의)
        'E': '#FF0000'   # 빨간색 (위험)
    }
    
    # 농경지별 ACI 등급 표시
    for farm in farm_data:
        folium.CircleMarker(
            location=[farm.lat, farm.lng],
            radius=8,
            color=color_map[farm.aci_grade],
            popup=f"ACI: {farm.aci_score}점"
        ).add_to(m)
    
    return m
```

### 📊 상세 분석 페이지

#### 트렌드 차트 (Chart.js)
```javascript
// 시계열 ACI 변화 그래프
const aci_chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: last_30_days,
        datasets: [{
            label: 'ACI 점수',
            data: aci_scores,
            borderColor: '#4CAF50',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { min: 0, max: 100 }
        }
    }
});
```

---

## ⚙️ 기술 스택 설계

### 🏗️ 시스템 아키텍처

#### 프론트엔드
```
React.js + TypeScript
├── 상태관리: Redux Toolkit
├── 지도: Leaflet + OpenLayers  
├── 차트: Chart.js + D3.js
├── UI: Material-UI + Tailwind CSS
└── 모바일: React Native (향후)
```

#### 백엔드
```
Node.js + Express.js
├── 데이터베이스: PostgreSQL + PostGIS (공간 데이터)
├── 캐시: Redis
├── API 게이트웨이: Kong
├── 메시지 큐: RabbitMQ
└── 스케줄러: Node-cron
```

#### AI/ML 파이프라인
```
Python + FastAPI
├── 머신러닝: TensorFlow + Scikit-learn
├── 데이터 처리: Pandas + NumPy
├── 시각화: Matplotlib + Plotly
├── 모델 서빙: TensorFlow Serving
└── MLOps: MLflow + DVC
```

#### 인프라 (클라우드)
```
AWS 기반
├── 컴퓨팅: EC2 + Lambda
├── 데이터베이스: RDS + ElastiCache  
├── 스토리지: S3 + EFS
├── CDN: CloudFront
├── 로드밸런서: ALB
├── 모니터링: CloudWatch + Grafana
└── CI/CD: CodePipeline + CodeDeploy
```

### 📡 데이터 수집 및 처리

#### 공공데이터 API 연동 모듈
```python
import requests
import asyncio
from datetime import datetime

class AgriDataCollector:
    def __init__(self):
        self.apis = {
            'farmmap': 'https://agis.epis.or.kr/api/farmmap',
            'weather': 'https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0',
            'pest': 'https://apis.data.go.kr/1390802/AgriPest',
            'soil': 'https://apis.data.go.kr/1390802/SoilEnv',
            'price': 'https://apis.data.go.kr/1390802/AgriPrice',
            'income': 'https://apis.data.go.kr/1390802/AgriIncome',
            'policy': 'https://apis.data.go.kr/1390802/AgriPolicy'
        }
    
    async def collect_all_data(self, farm_location):
        tasks = []
        for api_name, api_url in self.apis.items():
            tasks.append(self.fetch_data(api_name, api_url, farm_location))
        
        results = await asyncio.gather(*tasks)
        return self.merge_data(results)
    
    async def fetch_data(self, api_name, api_url, location):
        # 각 공공데이터 API 호출 로직
        params = self.build_params(api_name, location)
        response = requests.get(api_url, params=params)
        return response.json()
```

#### 실시간 데이터 파이프라인
```python
# Apache Airflow DAG
from airflow import DAG
from datetime import datetime, timedelta

dag = DAG(
    'agri_index_pipeline',
    default_args={
        'start_date': datetime(2025, 1, 1),
        'retries': 2,
        'retry_delay': timedelta(minutes=5)
    },
    schedule_interval='0 */6 * * *',  # 6시간마다 실행
    catchup=False
)

# Task 1: 공공데이터 수집
collect_task = PythonOperator(
    task_id='collect_public_data',
    python_callable=collect_all_agri_data,
    dag=dag
)

# Task 2: 데이터 전처리
process_task = PythonOperator(
    task_id='process_data',
    python_callable=process_and_clean_data,
    dag=dag
)

# Task 3: ACI 계산
calculate_task = PythonOperator(
    task_id='calculate_aci',
    python_callable=calculate_agri_index,
    dag=dag
)

# Task 4: 예측 모델 실행
predict_task = PythonOperator(
    task_id='predict_future_aci',
    python_callable=run_prediction_model,
    dag=dag
)

collect_task >> process_task >> calculate_task >> predict_task
```

---

## 🔐 보안 및 성능 최적화

### 보안 설계
```python
# JWT 기반 인증
# API Rate Limiting: 사용자당 1000req/hour
# 공공데이터 API 키 암호화 저장
# HTTPS 필수
# SQL Injection 방지 (ORM 사용)
```

### 성능 최적화
```python
# 캐싱 전략
redis_cache = {
    'aci_scores': 'TTL 1시간',
    'weather_data': 'TTL 30분', 
    'market_prices': 'TTL 2시간',
    'static_data': 'TTL 24시간'
}

# DB 최적화
postgresql_indexes = [
    'farm_location (GiST 인덱스)',
    'aci_score + datetime',
    'region_code + crop_type'
]
```

---

## 📅 3개월 개발 로드맵

### 1개월차: 기반 구축
- [ ] 공공데이터 API 연동 (7개)
- [ ] 기본 ACI 계산 알고리즘 구현
- [ ] 데이터베이스 스키마 설계
- [ ] 백엔드 API 기본 구조

### 2개월차: 핵심 기능 개발
- [ ] ACI 계산 엔진 완성
- [ ] 웹 대시보드 UI 개발
- [ ] 지도 기반 시각화 구현
- [ ] 예측 모델 기본 버전

### 3개월차: 완성 및 최적화
- [ ] 사용자 테스트 및 피드백 반영
- [ ] 성능 최적화 및 보안 강화
- [ ] 모바일 반응형 완성
- [ ] 배포 및 운영 환경 구축

---

## 💰 MVP 예산 산정

### 개발 비용
```
클라우드 인프라: 월 50만원 × 3개월 = 150만원
공공데이터 API 비용: 무료
개발 도구 라이선스: 100만원  
테스트 서버: 50만원
총 개발 비용: 300만원
```

### 운영 비용 (월간)
```
AWS 인프라: 200만원
도메인/SSL: 5만원
모니터링 도구: 20만원
총 운영 비용: 월 225만원
```

이 설계로 **3개월 내 MVP 구현**이 충분히 가능하며, 공공데이터 활용도 최대화와 독창성을 모두 확보했습니다!

---
*작성일: 2025년 6월 24일*  
*작성자: 박용환 (크리에이티브 넥서스)*